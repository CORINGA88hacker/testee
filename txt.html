<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Site com Abas Dinâmicas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    .nav-tabs { justify-content:center; margin-bottom:0.5rem; border-bottom:2px solid #ddd; }
    .nav-item { display:flex; flex-direction:column; align-items:center; margin:0 10px; }
    .tab-title { text-align:center; font-weight:600; color:#333; font-size:0.85rem; max-width:140px; white-space:normal; line-height:1.2; }
    .tab-pane { padding:1rem; border:1px solid #ddd; border-radius:6px; background:#fff; min-height:120px; }
    footer { margin-top:2rem; text-align:center; color:#888; font-style:italic; }
    .author-badge { font-size:.85rem; color:#666; }
  </style>
</head>
<body>
  <div class="container mt-4">
    <ul class="nav nav-tabs" id="tabs" role="tablist"></ul>
    <div class="tab-content mt-3" id="tabContent"></div>
    <footer id="autorFooter">Carregando autor...</footer>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <script>
  // mesma config do admin
  const FIREBASE_CONFIG = {
    apiKey: "AIzaSyBHIc2E4XwRO5FXo4uHlTQVRArOis73MjE",
    authDomain: "projeto-deus-yato-928-sk-default-rtdb.firebaseapp.com",
    databaseURL: "https://projeto-deus-yato-928-sk-default-rtdb.firebaseio.com",
    projectId: "projeto-deus-yato-928-sk-default-rtdb",
    storageBucket: "projeto-deus-yato-928-sk-default-rtdb.appspot.com",
    messagingSenderId: "790408726854",
    appId: "1:790408726854:android:e2f0de7b7d5dba96b0fd47"
  };

  firebase.initializeApp(FIREBASE_CONFIG);
  const db = firebase.database();

  const tabsEl = document.getElementById('tabs');
  const tabContentEl = document.getElementById('tabContent');
  const autorFooter = document.getElementById('autorFooter');

  function escapeHtml(str) {
    if (!str && str !== '') return '';
    return String(str)
      .replaceAll('&', '&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'", '&#039;');
  }

  function createTabs(data){
    tabsEl.innerHTML = '';
    tabContentEl.innerHTML = '';

    let primeiraAba = true;
    let indice = 1;
    for(const key of Object.keys(data || {})){
      const aba = data[key];
      const id = 'tab' + indice;

      const li = document.createElement('li');
      li.className = 'nav-item';
      li.setAttribute('role','presentation');

      const btn = document.createElement('button');
      btn.className = 'nav-link' + (primeiraAba ? ' active' : '');
      btn.id = id + '-tab';
      btn.type = 'button';
      btn.setAttribute('data-bs-toggle','tab');
      btn.setAttribute('data-bs-target','#' + id);
      btn.setAttribute('role','tab');
      btn.setAttribute('aria-controls', id);
      btn.setAttribute('aria-selected', primeiraAba ? 'true' : 'false');
      btn.textContent = 'Aba ' + indice;

      const titleDiv = document.createElement('div');
      titleDiv.className = 'tab-title';
      titleDiv.textContent = aba.title || 'Sem título';

      li.appendChild(btn);
      li.appendChild(titleDiv);
      tabsEl.appendChild(li);

      const contentDiv = document.createElement('div');
      contentDiv.className = 'tab-pane fade' + (primeiraAba ? ' show active' : '');
      contentDiv.id = id;
      contentDiv.setAttribute('role','tabpanel');
      contentDiv.setAttribute('aria-labelledby', id + '-tab');

      // monta conteúdo com autor
      const safeText = escapeHtml(aba.text || '');
      const author = escapeHtml(aba.author || '');
      contentDiv.innerHTML = `
        <div>${safeText.replace(/\n/g,'<br/>')}</div>
        <div class="mt-3 author-badge">Postado por: <strong>${author || 'Não informado'}</strong></div>
      `;
      tabContentEl.appendChild(contentDiv);

      primeiraAba = false;
      indice++;
    }
  }

  // atualiza quando houver mudanças nas abas
  db.ref('abas').on('value', snap => {
    const data = snap.val();
    if (data) createTabs(data);
    else {
      tabsEl.innerHTML = '<li class="nav-item"><span class="nav-link disabled">Nenhuma aba</span></li>';
      tabContentEl.innerHTML = '';
    }
  });

  // autor global opcional (mantive seu config/autor para compat)
  db.ref('config/autor').on('value', snap => {
    const autor = snap.val();
    autorFooter.textContent = autor ? `Autor global: ${autor}` : 'Autor global não definido';
  });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

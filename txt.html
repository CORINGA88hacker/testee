<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Poderes da República - Editor Colaborativo</title>

  <!-- Bootstrap + Ícones -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    /* (mesmo CSS do seu código, sem alterações para brevidade) */
    :root {
      --bg-dark: #121212;
      --bg-light: #f5f5f5;
      --text-dark: #222;
      --text-light: #eee;
      --primary-color: #e74c3c;
    }
    body {
      margin: 0; padding: 20px;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-light);
      transition: background-color 0.3s ease, color 0.3s ease;
      user-select: none;
    }
    body.light {
      background-color: var(--bg-light);
      color: var(--text-dark);
    }

    h1 {
      color: var(--primary-color);
      text-align: center;
      margin-bottom: 1rem;
      user-select: text;
    }

    .nav-tabs {
      border-bottom: 2px solid var(--primary-color);
      user-select: none;
    }
    .nav-tabs .nav-link {
      color: #ccc;
      font-weight: 600;
      border: none;
      transition: background-color 0.3s, color 0.3s;
      user-select: none;
    }
    .nav-tabs .nav-link:hover:not(.active) {
      color: var(--primary-color);
    }
    .nav-tabs .nav-link.active {
      color: #fff;
      background-color: var(--primary-color);
      border-radius: 8px 8px 0 0;
      user-select: none;
    }

    .tab-content {
      background: var(--bg-dark);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(231,76,60,0.25);
      height: 70vh;
      overflow-y: auto;
      scroll-behavior: smooth;
      user-select: text;
    }
    body.light .tab-content {
      background: var(--bg-light);
      box-shadow: 0 0 20px rgba(231,76,60,0.2);
      color: var(--text-dark);
    }

    input[type="text"], textarea {
      width: 100%;
      border-radius: 8px;
      border: 1.5px solid #444;
      padding: 12px;
      font-size: 1rem;
      background-color: #1a1a1a;
      color: #eee;
      transition: background-color 0.3s, color 0.3s, border-color 0.3s;
      user-select: text;
      resize: vertical;
    }
    body.light input[type="text"], body.light textarea {
      background-color: #fff;
      color: var(--text-dark);
      border-color: #ccc;
    }
    input[type="text"]:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 5px var(--primary-color);
    }

    textarea {
      min-height: 200px;
      max-height: 60vh;
      scrollbar-width: thin;
    }
    textarea::-webkit-scrollbar {
      width: 8px;
    }
    textarea::-webkit-scrollbar-thumb {
      background-color: var(--primary-color);
      border-radius: 10px;
    }

    .btn {
      user-select: none;
      transition: background-color 0.3s ease;
      min-width: 110px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .btn:hover {
      filter: brightness(110%);
    }
    .btn-clear {
      margin-left: 10px;
    }

    .saved-message {
      margin-top: 8px;
      font-size: 0.9rem;
      opacity: 0;
      transition: opacity 0.5s ease;
      user-select: none;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .saved-message.show {
      opacity: 1;
    }
    .msg-green { color: #2ecc71; }
    .msg-red { color: #e74c3c; }
    .msg-yellow { color: #f1c40f; }

    .status-bar {
      display: flex;
      justify-content: space-between;
      margin-top: -10px;
      margin-bottom: 10px;
      font-size: 0.9rem;
      user-select: none;
    }

    .search-box {
      margin-bottom: 12px;
    }
    .search-box input {
      padding-left: 2rem;
      font-size: 1rem;
      position: relative;
    }
    .search-icon {
      position: absolute;
      margin-left: 10px;
      margin-top: 8px;
      color: var(--primary-color);
      pointer-events: none;
      user-select: none;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 52px;
      height: 28px;
      margin-left: 10px;
      vertical-align: middle;
    }
    .switch input { display:none; }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: #ccc;
      border-radius: 34px;
      transition: .4s;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 22px; width: 22px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      border-radius: 50%;
      transition: .4s;
    }
    input:checked + .slider {
      background-color: var(--primary-color);
    }
    input:checked + .slider:before {
      transform: translateX(24px);
    }

    [data-bs-toggle="tooltip"] {
      cursor: pointer;
    }

    @media (max-width: 576px) {
      .btn {
        min-width: 80px;
        font-size: 0.85rem;
      }
      .d-flex {
        flex-wrap: wrap;
        gap: 8px;
      }
    }
  </style>
</head>
<body>

<h1 id="tituloPagina" tabindex="0">Editor - Poderes da República</h1>

<div class="d-flex justify-content-center align-items-center mb-3 flex-wrap gap-3">
  <label for="toggleTema" class="form-label mb-0">Modo Claro/Escuro</label>
  <label class="switch" title="Alternar modo claro/escuro">
    <input type="checkbox" id="toggleTema" />
    <span class="slider"></span>
  </label>

  <label class="d-flex align-items-center gap-1" title="Ativar/Desativar som de salvamento">
    <input type="checkbox" id="toggleSom" />
    <i class="bi bi-volume-up-fill" id="iconeSom" style="color:#e74c3c; font-size:1.25rem;"></i>
  </label>
</div>

<!-- MENU DE ABAS -->
<ul class="nav nav-tabs" id="tabMenu" role="tablist" aria-label="Editor tabs">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="tab1-tab" data-bs-toggle="tab" data-bs-target="#tab1" type="button" role="tab" aria-controls="tab1" aria-selected="true">
      1. Separação dos Poderes
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="tab2-tab" data-bs-toggle="tab" data-bs-target="#tab2" type="button" role="tab" aria-controls="tab2" aria-selected="false">
      2. Constituição de 1988
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="tab3-tab" data-bs-toggle="tab" data-bs-target="#tab3" type="button" role="tab" aria-controls="tab3" aria-selected="false">
      3. Poder Legislativo
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="tab4-tab" data-bs-toggle="tab" data-bs-target="#tab4" type="button" role="tab" aria-controls="tab4" aria-selected="false">
      4. Poder Executivo
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="tab5-tab" data-bs-toggle="tab" data-bs-target="#tab5" type="button" role="tab" aria-controls="tab5" aria-selected="false">
      5. Poder Judiciário
    </button>
  </li>
</ul>

<!-- CONTEÚDO DAS ABAS -->
<div class="tab-content" id="conteudoAbas">
  <!-- Abas criadas por JS -->
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // Config Firebase - seu projeto
  const firebaseConfig = {
    apiKey: "AIzaSyBHIc2E4XwRO5FXo4uHlTQVRArOis73MjE",
    authDomain: "projeto-deus-yato-928-sk-default-rtdb.firebaseapp.com",
    databaseURL: "https://projeto-deus-yato-928-sk-default-rtdb.firebaseio.com",
    projectId: "projeto-deus-yato-928-sk-default-rtdb",
    storageBucket: "projeto-deus-yato-928-sk-default-rtdb.appspot.com",
    messagingSenderId: "790408726854",
    appId: "1:790408726854:android:e2f0de7b7d5dba96b0fd47"
  };

  // Inicializa Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const conteudoAbas = document.getElementById('conteudoAbas');
  const tituloPagina = document.getElementById('tituloPagina');
  const toggleTema = document.getElementById('toggleTema');
  const toggleSom = document.getElementById('toggleSom');
  const iconeSom = document.getElementById('iconeSom');

  let autoSaveTimers = {};
  let textoAnterior = {};
  let somAtivo = false;
  let somSave;

  // Cria abas dinamicamente
  for(let i=1; i<=5; i++){
    const tab = document.createElement('div');
    tab.className = `tab-pane fade${i===1?' show active':''}`;
    tab.id = `tab${i}`;
    tab.setAttribute('role','tabpanel');
    tab.setAttribute('aria-labelledby', `tab${i}-tab`);
    tab.innerHTML = `
      <input type="text" id="autor${i}" placeholder="@SeuNome" aria-label="Nome do autor do slide ${i}" oninput="atualizarNome(${i})" />
      <div>Escrito por: <span id="nome${i}">Ninguém ainda</span></div>

      <div class="search-box position-relative">
        <input type="search" id="search${i}" placeholder="Buscar texto nesta aba..." aria-label="Pesquisar texto na aba ${i}" oninput="filtrarTexto(${i})" autocomplete="off" />
        <i class="bi bi-search search-icon"></i>
      </div>

      <textarea id="txt${i}" placeholder="Digite aqui..." aria-label="Conteúdo do slide ${i}" oninput="aoDigitar(${i})"></textarea>

      <div class="status-bar">
        <span id="contador${i}">Linhas: 0 | Caracteres: 0</span>
      </div>

      <div class="d-flex mt-2 flex-wrap">
        <button class="btn btn-success" onclick="salvar(${i})" data-bs-toggle="tooltip" data-bs-placement="top" title="Salvar manualmente"><i class="bi bi-check-circle"></i> Salvar</button>
        <button class="btn btn-danger btn-clear" onclick="limpar(${i})" data-bs-toggle="tooltip" data-bs-placement="top" title="Limpar texto e autor"><i class="bi bi-trash3"></i> Limpar</button>
        <button class="btn btn-warning" onclick="exportarTexto(${i})" data-bs-toggle="tooltip" data-bs-placement="top" title="Exportar conteúdo para arquivo TXT"><i class="bi bi-download"></i> Exportar</button>
      </div>

      <div class="saved-message" id="msg${i}" role="alert" aria-live="polite" aria-atomic="true"></div>
    `;
    conteudoAbas.appendChild(tab);
  }

  // Inicializar tooltips Bootstrap
  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
  const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
  });

  // Carregar dados do Firebase e ativar eventos
  window.onload = () => {
    // Modo tema
    const temaSalvo = localStorage.getItem('temaEscuro');
    if(temaSalvo === 'false'){
      document.body.classList.add('light');
      toggleTema.checked = true;
    }

    // Som
    const somSalvo = localStorage.getItem('somAtivo');
    if(somSalvo === 'true'){
      somAtivo = true;
      toggleSom.checked = true;
      iconeSom.style.color = 'var(--primary-color)';
    } else {
      iconeSom.style.color = '#666';
    }

    // Escutar dados do Firebase para cada aba e atualizar conteúdo
    for(let i=1; i<=5; i++){
      db.ref(`slides/slide${i}`).on('value', (snapshot) => {
        const data = snapshot.val();
        if(data){
          const nomeInput = document.getElementById(`autor${i}`);
          const nomeDisplay = document.getElementById(`nome${i}`);
          const txtArea = document.getElementById(`txt${i}`);

          nomeInput.value = data.autor || '';
          nomeDisplay.textContent = data.autor || 'Ninguém ainda';
          txtArea.value = data.texto || '';
          txtArea.disabled = !data.autor;

          atualizarContador(i);
          textoAnterior[i] = data.texto || '';
        }
      });
    }

    atualizarTitulo();

    // Atalho Ctrl+S salvar aba atual
    window.addEventListener('keydown', e => {
      if(e.ctrlKey && e.key.toLowerCase() === 's'){
        e.preventDefault();
        const abaAtiva = document.querySelector('.tab-pane.show.active');
        if(abaAtiva){
          const id = parseInt(abaAtiva.id.replace('tab',''));
          salvar(id);
        }
      }
    });
  }

  function atualizarTitulo(){
    const abaAtiva = document.querySelector('.nav-link.active');
    if(abaAtiva){
      document.title = `Editor - ${abaAtiva.textContent.trim()}`;
      tituloPagina.textContent = `Editor - ${abaAtiva.textContent.trim()}`;
    }
  }

  function atualizarNome(i){
    const nomeInput = document.getElementById(`autor${i}`);
    const nomeDisplay = document.getElementById(`nome${i}`);
    const textoArea = document.getElementById(`txt${i}`);

    const nome = nomeInput.value.trim();
    nomeDisplay.textContent = nome || 'Ninguém ainda';
    textoArea.disabled = nome === '';

    if(nome === ''){
      mostrarMensagem(i, 'Preencha o nome para habilitar o texto', 'msg-red');
    } else {
      limparMensagem(i);
    }
  }

  function aoDigitar(i){
    mostrarMensagem(i, 'Digitando...', 'msg-yellow');
    atualizarContador(i);

    if(autoSaveTimers[i]) clearTimeout(autoSaveTimers[i]);
    autoSaveTimers[i] = setTimeout(() => {
      const texto = document.getElementById(`txt${i}`).value;
      if(textoAnterior[i] !== texto){
        salvar(i);
      } else {
        limparMensagem(i);
      }
    }, 5000);
  }

  function atualizarContador(i){
    const texto = document.getElementById(`txt${i}`).value;
    const linhas = texto.split('\n').length;
    const caracteres = texto.length;
    document.getElementById(`contador${i}`).textContent = `Linhas: ${linhas} | Caracteres: ${caracteres}`;
  }

  function salvar(i){
    const nomeInput = document.getElementById(`autor${i}`);
    const textoArea = document.getElementById(`txt${i}`);
    const nomeDisplay = document.getElementById(`nome${i}`);

    const nome = nomeInput.value.trim();
    const texto = textoArea.value;

    if(!nome){
      mostrarMensagem(i, 'Digite seu nome antes de salvar!', 'msg-red');
      return;
    }

    db.ref(`slides/slide${i}`).set({
      autor: nome,
      texto: texto
    }).then(() => {
      nomeDisplay.textContent = nome;
      textoAnterior[i] = texto;
      mostrarMensagem(i, 'Salvo no servidor com sucesso!', 'msg-green');
      if(somAtivo) tocarSomSalvo();
      setTimeout(() => limparMensagem(i), 2500);
    }).catch(() => {
      mostrarMensagem(i, 'Erro ao salvar no servidor', 'msg-red');
    });
  }

  function limpar(i){
    if(!confirm('Tem certeza que quer limpar nome e texto desta aba?')){
      return;
    }
    db.ref(`slides/slide${i}`).remove();
  }

  function mostrarMensagem(i, msg, classe){
    const msgEl = document.getElementById(`msg${i}`);
    msgEl.textContent = msg;
    msgEl.className = `saved-message show ${classe}`;
  }

  function limparMensagem(i){
    const msgEl = document.getElementById(`msg${i}`);
    msgEl.className = 'saved-message';
  }

  function exportarTexto(i){
    const nomeInput = document.getElementById(`autor${i}`);
    const textoArea = document.getElementById(`txt${i}`);

    const nome = nomeInput.value.trim() || 'Anonimo';
    const texto = textoArea.value || '';

    const blob = new Blob([texto], { type: 'text/plain;charset=utf-8' });
    const link = document.createElement('a');
    link.download = `slide${i}_${nome}.txt`;
    link.href = URL.createObjectURL(blob);
    link.click();
    URL.revokeObjectURL(link.href);
  }

  function filtrarTexto(i){
    const searchInput = document.getElementById(`search${i}`);
    const textoArea = document.getElementById(`txt${i}`);

    const termo = searchInput.value.toLowerCase();
    const textoOriginal = textoArea.value;

    if(!termo){
      textoArea.value = textoAnterior[i] || '';
      return;
    }

    // Filtrar linhas que contenham o termo
    const linhas = textoAnterior[i].split('\n');
    const linhasFiltradas = linhas.filter(l => l.toLowerCase().includes(termo));
    textoArea.value = linhasFiltradas.join('\n');
  }

  // Tema claro/escuro
  toggleTema.addEventListener('change', () => {
    if(toggleTema.checked){
      document.body.classList.add('light');
      localStorage.setItem('temaEscuro', 'false');
    } else {
      document.body.classList.remove('light');
      localStorage.setItem('temaEscuro', 'true');
    }
  });

  // Som ao salvar
  toggleSom.addEventListener('change', () => {
    somAtivo = toggleSom.checked;
    localStorage.setItem('somAtivo', somAtivo ? 'true' : 'false');
    iconeSom.style.color = somAtivo ? 'var(--primary-color)' : '#666';
  });

  // Som de salvamento
  function tocarSomSalvo(){
    if(!somSave){
      somSave = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');
    }
    somSave.play();
  }

  // Atualizar título e tabs
  const navLinks = document.querySelectorAll('.nav-link');
  navLinks.forEach(link => {
    link.addEventListener('shown.bs.tab', () => {
      atualizarTitulo();
    });
  });
</script>

</body>
</html>
